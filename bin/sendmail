#!/usr/bin/env ruby

require 'net/smtp'

f = File.open(ARGV[1])
content = f.read
f.close

sender     = 'miguel.moquillon@silverpeas.org'
recipients = {'Miguel Moquillon'  => 'miguel.moquillon@silverpeas.com', 
              'Yohann Chastagnier'=> 'yohann.chastagnier@silverpeas.com'}

recipients_str = recipients.map {|n,e| "#{n} <#{e}>"}.join(', ')
message = <<MESSAGE_END
From: Jenkins <#{sender}>
To: #{recipients_str}
MIME-Version: 1.0
Content-type: text/plain
Subject: #{ARGV[0]}

#{content}

MESSAGE_END

Net::SMTP.start('localhost', 25) do |smtp|
    smtp.send_message message,
                      sender,
                      recipients.collect {|n,e| e}
end
